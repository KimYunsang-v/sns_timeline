<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://thymeleaf.org"
>

<head>
    <meta id="_csrf" name="_csrf" th:content="${_csrf.token}"/>
    <meta id="_csrf_header" name="_csrf_header" th:content="${_csrf.headerName}"/>
    <th:block th:replace="fragments/commonHead"></th:block>
</head>

<body>
<!-- Header Section -->
<header th:replace="fragments/commonHeader :: header"></header>

<section class="elements-section spad">
    <div class="element">
        <div class="col-lg-4 col-md-6 sidebar">
            <div class="sb-widget">
                <form class="search-form" th:action="@{/member/search/do}" th:method="GET">
                    <input th:id="search" type="text" placeholder="검색어를 입력해 주세요." th:name="search">
                    <button th:type="submit">
                        <img src="img/search-icon.png" alt="">
                    </button>
                </form>
            </div>
        </div>

        <div id="result" class="element" th:if="${memberDtoList} != null">
            <div class="row" th:each="memberDto, i : ${memberDtoList}">
                <div class="col-md-4">
                    <div class="icon-box-item">
                        <form th:action="@{/subscribe}" th:object=${subscribeDto} method="post">
                            <input type="hidden" name="id" th:value="${memberDto.getId()}"/>
                            <input type="hidden" name="search" th:value="${search}"/>
                            <input type="hidden" name="page" th:value="${memberDtoList.getPageable().getPageNumber()}"/>
                            <button class="ib-icon btn" type="submit">
                                <i class="flaticon-036-customer-service"></i>
                            </button>
                        </form>

                        <div class="ib-text">
                            <h4>
                                <span th:text="${memberDto.getEmail()}" th:remove="tag">Email</span>
                                <br/>
                                <small th:text="${memberDto.getName()}" >Name</small>
                            </h4>
                        </div>
                    </div>
                </div>
            </div>

            <nav class="site-pagination" th:if="${memberDtoList.getTotalPages() > 1}">
                <ul class="pagination" th:with="start=${start}, last=${last}">
                    <li>
                        <a th:href="@{/member/search/do(search = ${search},page=1)}" aria-label="First">
                            <span aria-hidden="true">First</span>
                        </a>
                    </li>

                    <li th:class="${memberDtoList.first} ? 'disabled'">
                        <a th:href="@{/member/search/do(search = ${search}, page=${memberDtoList.getPageable().getPageNumber()})}"
                           aria-label="Previous">
                            <span aria-hidden="true">&lt;</span>
                        </a>
                    </li>

                    <li th:each="page: ${#numbers.sequence(start, last)}"
                        th:class="${page == memberDtoList.getPageable().getPageNumber() + 1} ? 'active'">
                        <a th:text="${page}" th:href="@{/member/search/do(search = ${search}, page=${page})}"></a>
                    </li>

                    <li th:class="${memberDtoList.last} ? 'disabled'">
                        <a th:href="@{/member/search/do(search = ${search}, page=${memberDtoList.getPageable().getPageNumber()+2})}"
                           aria-label="Next">
                            <span aria-hidden="true">></span>
                        </a>
                    </li>

                    <li>
                        <a th:href="@{/member/search/do(search = ${search},page = ${memberDtoList.getTotalPages()})}" aria-label="Last">
                            <span aria-hidden="true">Last</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
    </div>
</section>

<!--====== Javascripts & Jquery ======-->
<script src="/resources/js/jquery-3.2.1.min.js"></script>
<script src="/resources/js/bootstrap.min.js"></script>
<script src="/resources/js/jquery.slicknav.min.js"></script>
<script src="/resources/js/owl.carousel.min.js"></script>
<script src="/resources/js/jquery-ui.min.js"></script>
<script src="/resources/js/main.js"></script>

<script type="text/javascript" th:inline="javascript">
    /* <![CDATA[ */
    const isNull = /*[[${isNull}]]*/ false;
    const memberDto = /*[[${memberDtoList.getContent()}]]*/ null;

    $(document).ready(function () {
        if(isNull) {
            alert("검색 결과가 없습니다.");
        }

    //     const token = $('#_csrf').attr('content');
    //     const header = $('#_csrf_header').attr('content');
    //
    //     $('#subscribeBtn').click(function(e) {
    //         e.preventDefault();
    //         const memberDtoId = $('#subscribeBtn').val();
    //         console.log(memberDto[0].getKey('id'));
    //         $.ajax({
    //             url: '/subscribe',
    //             type: 'post',
    //             dataType: 'JSON',
    //             data : {
    //               id : memberDtoId
    //             },
    //             timeout: 10000,
    //             beforeSend: function(xhr) {
    //                 xhr.setRequestHeader(header, token);
    //             },
    //             success: function(data) {
    //                 console.log("success")
    //             }
    //         });
    //     });
    });

    function addSubscribe(e, id) {
        const url = "/subscribe";
        e.preventDefault();
        console.log(id);

        const request = {
            id: id
        }

        $.ajax({
            type: "post",
            data: request,
            url: url,
            async: false,
            dataType: "json",
            success: function () {
                alert("success");
            }
        });
    }
    /* ]]> */
</script>
</body>
</html>
